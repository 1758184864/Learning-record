# 第一次课

**打开SQL服务:**
1. SQL配置管理器（C:\Windows\SysWOW64）
2. 控制面板----管理工具-----服务----SQL Server服务
3. 我的电脑----管理----服务----SQL Server服务
4. win+R  services.msc 

MSSQLSERVER实例名

**登录用户名：**
1. 计算机名\实例名
2. `.`
3. IP地址
4. localhost\实例名

# 第二次课

数据：在计算机系统中，凡是能被计算机存储并处理的数字、字符、图形和声音等统称为数据，分为两类（数值型、非数值型）

信息：有意义的数据

数据处理：将数据转换成信息的过程

1946年世界第一台计算机

数据库(DataBass):存放数据的仓库，数据库是长期存储在计算机内的、有组织的、可以共享的数据集合

**数据库特点：**
1. 数据库中的数据按一定的数据模型组织、存放
2. 具有较小的数据冗余
3. 具有较高的数据独立性和易扩充性
4. 为各用户所享
数据库管理系统(DBMS):数据库系统的主要软件系统，负责对数据库进行管理和维护，借助于操作系统实现对数据的存储管理。

数据库系统(DBS)

DBS包含BD和DBMS

# 第三次课

数据模型：是现实世界数据特征的抽象，是现实世界的模拟

数据模型分为：概念模型和结构数据模型

概念模型：是按用户的观点来对你数据和信息进行抽象，主要用于数据库设计

结构数据模型：它是按计算机的观点建模，主要用于DBMS的实现

需求分析——概念模型（E-R）——数据模型（DBMS）

E实体，R联系

关系模型（二维表）：每一列（属性）、每一行（元组）

**信息世界基本概念**

实体：是指客观存在并可以相互区别的事物。实体可以是具体的人、事、物，也可以是抽象的概念和联系

属性：具有的某一特征称为实体的属性，一个实体有若干个属性来描述

码：唯一标识实体的属性集成为码

域：属性的取值范围称为该属性的域

实体型：有相同属性的实体成为同型实体，用实体名及其属性名的集合来抽象和刻画同类实体，称为实体型

实体集：同型实体的集合

联系：实体与实体之间的关系（一对一、一对多、多对多）


# 第四次课

**E-R图中内容**
实体，名词，矩形
属性，名词，椭圆
关系，动词，菱形
属性加横线是码，E-R图中也要注明

关系模型：用二维表格结构来表示实体和实体之间的关系的模型

关系模式：一行之间的关系

主键、主关键字、主码：能区分每一个数据的东西

非主属性、非码属性：除了主码外的属性

外部关键字、外键：当关系中的某个属性或属性组合不是该关系的关键字或知识关键字的一部分，但却是另一个关系的关键字时，称他为外键、外部关键字

# 第五次课

第一范式（1NF）是指关系中的所有属性都是不可再分的数据项，同一列中不能有多个值（消除属性多值）

第二范式（2NF）数据库表满足第一范式，并且每一列都依赖主键，联合主键时每一列都完全依赖于主键（消除部分依赖）

第三范式（3NF）若果一个关系满足2NF，并且除了主键以外的其他列都不传递依赖于主键列，则满足第三范式（消除传递依赖）

# 第六次课

**数据库文件**
1. 主数据文件（.MDF）存放数据库数据和启动信息（有且只有一个）
2. 辅助数据文件（.NDF）用来存放数据，可以多个，也可以没有。
3. 事务日志文件（.LDF）用于存放数据库操作日志，至少有一个。

查询数据库文件
`sp_helpdb 数据库名`

默认创建数据库
`create database 数据库名`

在指定目录创建数据库
```
create database 数据库名
on primary 
(name='逻辑名',
filename='文件路径下文件名',
size=初始大小,
maxsize=最大值,
filegrowth=增量),
(name='student3_data2',
filename='f:\mysql\student3_data2.ndf'
)
log on
(name='student3_log',
filename='f:\mysql\student3_log.ldf',
size=1mb,
maxsize=10mb,
filegrowth=10%)
go
```

# 第七次课

打开数据库
`use 数据库名`

重命名数据库
`sp_renamedb '原名','新名'`

添加数据库文件
```
alter database 数据库名
add （log）file
（name='逻辑名',
filename='物理名',
size='初始大小',
maxsize='最大值',
fillegrowth='增量'）
```

修改数据库文件
```
alter database 数据库名
modify file
（name='逻辑名',
size='初始大小',
maxsize='最大值',
fillegrowth='增量'）
```
删除数据库文件
```
alter database 数据库名
remove file 逻辑名
```
删除数据库
`drop database 数据库名`

分离数据库
`sp_detach_db 数据库名`

附加数据库
```
create database 数据库名
on (主数据文件路径)
for attach
```
数据文件无法删除时
```
go
dbcc shrinkfile (逻辑名, emptyfile);
go
alter database [数据库名]
remove file 逻辑名;
go
```

# 第八次课

数据类型
字符型：char（长度确定时使用） varchar（长度不定时使用）
时间日期型：date（年月日） datetime（年月日 时分秒）
数值型：tinyint（0~255） smallint（-2的15次方~2的15次方-1） int（-2的31次方~2的31次方-1） bigint（-2的63次方~2的63次方-1）
浮点型：numeric（p,s） decimal（p,s）

命令建表
```
create table 表名
(majorno char(4) constraint pk_majorno primary key,
majorname varchar(30) not null,
depno char(2) constraint fk_xbbn references dept(deptno))
```

外键的类型和长度与主键一致

数据库表查询
打开数据库
select*from 表名

# 第九次课

命令设置外键
```
alter table student
add constraint fk_classon foreing key(classno)
references class(classon)
```
sql约束
1. 主键（primary key）：值不能为空，不能重复
2. 外键（foreing key）：实际上就是在做两个表的关系
3. 空/非空（null/not null）

# 第十次课

检查约束

# 第十一次课
数据的完整性：输入数据要准确，无误。
1. 实体完整性：主键
2. 域完整性：检查
3. 参照完整性：外键

命令添加默认约束
```
alter table 表名
add constraint 约束名字df_ default ('内容') for 列名
```

查询表
`sp_help 表名`

删除约束
```
alter table 表名
drop constaint 约束名
```

添加约束
```
alter table 表名
add constraint 约束名字ck_  check (约束内容)
```

建表三大步
1. 创建表结构
2. 创建约束
3. 添加数据

定义语句：creat alter drop
操作语句：insert update delete


命令填表
```
insert into 表名(字段名1,字段名2...)
values(值1,值2...)
```

当表达式数量与表中字段的数量相同，
并且顺序也相同，则表名后的字段名可省略

# 第十二次课

修改表数据
```
update 表名 set 修改字段名=修改值
[where 修改条件 or(and) 修改条件] 

//单字段修改
update student set shome='攀枝花'
where sname='李爽'

//多字段修改
update student set shome='攀枝花',sbirth='2001/04/03'
where sname='李爽'
```

删除表数据
```
delete from 表名
[where 修改条件 or(and) 修改条件] 
```

用现有表生成新表
```
select* into student2 from student
```

# 第十三次课

数据查询
```
select 字段1、字段2...from 表名
[where 查询条件]
[order by 字段名 asc(升序)| desc(降序)] 默认按升序排序
[group by 字段名] 对查询结果分组
[having 筛选条件] 对分组结果筛选
[into 新表名] 用查询结果生成新表
```

简单查询(单表)：从一个表中查询数据
高级查询(多表)：从多个表中查询数据

简单查询
选择若干列(投影)
```
select 字段名1、字段名2... from 表名
```
对于没有的字段名
```
例年龄
select year(getdate())-year(sbirth) as age from student
```
别名多种写法
```
select sname as 姓名,shome as 住址 from student
select '姓名'=sname,'住址'=shome from student
select sname 姓名,shome 住址 from student
```

# 第十四次课
简单查询
查询表中的若干记录
1. **运算符**
- 比较运算：=、!=、<>、>、<、>=、<=,可加not
- 确定范围：between and/not between and (相当于>= and <=)
- 确定集合：in/not in ()
- 字符匹配(模糊)：like/not like
  通配符：%:任意个数的字符，_:任意一个字符
- 空值：is null/is not null
- 多重条件：and or not
- 消除取值重复行 select distinct 字段名 from 表名
- 限制返回行数 select top n 字段名 from 表名
- 排序：order by 字段名 asc/desc 默认升序

# 第十五次课
多条件排序
```
select sname ,age=year(getdate()) - year(sbirth) from student
order by age asc,sname asc
```

集合函数
```
count(*)  统计行数
count(列名)  统计一列值的个数  null不参与计数
sum(列名)  计算一列值的和(列的类型必须是数值型)
avg(列名)  计算一列的值的平均值(列的数据类型必须是数值型)
max(列名)  求一列中值的最大值
min(列名)  求一列中值的最小值
union  合并查询结果集合(要合并的俩集合，查询数量要相同)
union可以允许重复值
```

分组统计
```
select 字段名 from 表名
where 查询条件
order by 关键字
group by 字段名
having 在分组基础上进行操作

例子
select tsex 性别,avg(year(getdate())-year(tsbirth)) 平均年龄
where tsex ='男'
group by tsex
union
select tsex 性别,avg(year(getdate())-year(tsbirth)) 平均年龄
where tsex ='女'
group by tsex
```

# 第二十次课
高级查询(多表)
从多个表中查询
类型：连接查询、子查询
连接查询：交叉连接连接、等值或非等值链接、自然连接、自身连接、外连接

交叉连接：又称笛卡尔积，它是将两个表不加任何约束条件连接在一起，连接结果集中，列是两个表列的和，记录是两个表记录乘积
```
select * from 表名1 cross join 表名2
```

等值连接：连接查询中用来链接两个表的条件中的运算符是等号的称为等值连接，不是等号称为非等值连接
```
select 字段名 from 表名1 [inner] join 表名2
on 表名1.字段名=表名2.字段名
```
```
select 字段名 from 表名1,表名2
where 表名1.字段名=表名2.字段名
```

自然连接：将等值连接中重复列去掉

内连接：查询结果全部是满足连接的，不满足不会显示

外连接：
1. 左外连接：将左表作为主表，表中所有记录分别与右表的每一条记录进行连接组合，结果集除了满足连接条件的记录外，不满足连接条件的记录也会显示，在对应位置补null
```
select 字段名 from 表名1 left outer join 表名2
on 表名1.列名 = 表名2.列名
```
2. 右外连接：将右表作为主表，表中所有记录分别与左表的每一条记录进行连接组合，结果集除了满足连接条件的记录外，不满足连接条件的记录也会显示，在对应位置补null
```
select 字段名 from 表名1 right outer join 表名2
on 表名1.列名 = 表名2.列名
```
3. 全外连接：显示所有值
```
select 字段名 from 表名1 full join 表名2
on 表名1.列名 = 表名2.列名
```
4. 三表外连接
```
select sname,cname,score from (student s left outer join score
on s.sno = score.sno)
left outer join course c
on score.cno = c.cno
go
```

# 第二十一次课
子查询
```
select * from student
where year(getdate())-year(sbirth)>
(select avg(year(getdate())-year(sbirth)) 平均年龄 from student )
```

子查询的返回值不止一个时，不能使用比较运算符

带有any和all的子查询
```
>any(1,2,3)  大于其中任何值
>all(1,2,3)  大于其中所有值
```

# 第二十二次课
带exists的子查询，子查询不返回任何数据，只产生逻辑值true or false,可以加not
```
select sno,sname from student
where exists
(select * from score 
where exists	 
(select * from course
where cname = '数据库应用' and score.cno = course.cno) and student.sno = sno)
```

# 第二十四次课
视图是一种数据库对象，主要作用是用来简化查询，是一种虚拟表

创建视图
```
create view 视图名 [(列名1，列名2)]
as
select语句
```
修改视图
```
alter view 视图名 [(列名1，列名2)]
as
select语句
```
删除视图
```
drop view 视图名
```
修改视图数据,实际是修改了表数据
```
update 视图名 set 姓名=''
where
```

# 第二十五次课
存储过程：数据库中的一个对象，他是为了完成一个具体任务而由sql命令构成集合。

用户自定义存储过程(创建存储过程)：
```
create proc[dure] 存储过程名称
as
sql语句
```
执行存储过程
```
exec[ute] dbo.ProTest
```

```
创建带参存储过程
create procedure p_c @xs char(2)
as
select sname from student
where left(sname,1) = @xs
go
```
删除存储过程
```
create procedure 存储过程名
```

# 第二十六次课
索引：数据库的一种对象，建立在数据表上，本质就是字段的排序规则(asc/desc),提高数据的查询速度

分类：
- 聚集索引：会影响表中记录的顺序(与聚集索引顺序一致)，一个表中聚集索引只能有一个
- 非聚集索引：不会影响表中记录的顺序，一个表中非聚集索引可以有多个

创建索引：
- 图形界面：表---表设计---索引/键
- sql命令：
```
create [clustered | nonclustered] index 索引名
on 表名 (字段名 asc | desc，字段名2 asc | desc)
```
查看索引
```
sp_help 表名
sp_helpindex 表名
```
删除索引
```
drop indexx 表名.索引名
```

# 第二十七次课
新建登录名
安全性——登录名——新建登录名——用户映射——数据库名(分配权限)

新建架构
安全性——新建架构