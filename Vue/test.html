<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<style>
  .avatar-uploader .el-upload {
    border: 1px dashed #d9d9d9;
    border-radius: 6px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }
  .avatar-uploader .el-upload:hover {
    border-color: #409EFF;
  }
  .avatar-uploader-icon {
    font-size: 28px;
    color: #8c939d;
    width: 178px;
    height: 178px;
    line-height: 178px;
    text-align: center;
  }
  .avatar {
    width: 178px;
    height: 178px;
    display: block;
  }
</style>

<body>
    <div id="app">
    <el-upload
      class="avatar-uploader"
      action="http://127.0.0.1:8080/avatar/upload"
      :show-file-list="false"
      :on-success="handleAvatarSuccess"
      :before-upload="beforeAvatarUpload">
      <img v-if="imageUrl" :src="imageUrl" class="avatar">
      <i v-else class="el-icon-plus avatar-uploader-icon"></i>
    </el-upload>
    <form action="http://127.0.0.1:8080/avatar/upload2" enctype="multipart/form-data" method="post">
      <input type="file" name="file"/>
      <input type="submit" value="upload">
    </form>
    </div>
    <script>
    new Vue({
        // el挂载点用于锁定元素,相当于css选择器
      el: '#app',
        //data对象用于存放键值对数据，可用直接用键名获取数据
        data() {
    return {
      imageUrl: '',
      form: {
        username: '',
        name: '',
        avatar: '',
        id: ''
      }
    }},
    methods: {
    onSubmit() {
      if(null === this.form.username || "" === this.form.username){
        this.$message.error("请填写完整的信息")
        return
      }
      var data = {
        id: this.$store.getters.id,
        username : this.form.username,
        name: this.form.name
      }

      updateUserInfo(data).then(
        response=>{
            this.$message.success(response.message)
            this.$router.go(0)
        }
        
      )

      console.log(data);
    },
    onCancel() {
      this.$message({
        message: 'cancel!',
        type: 'warning'
      })
    },
    handleAvatarSuccess(res, file) {
      this.imageUrl = URL.createObjectURL(file.raw);
    },
    beforeAvatarUpload(file) {
      const isJPG = file.type === 'image/jpeg' || file.type === 'image/jpg' || file.type === 'image/png';
      const isLt2M = file.size / 1024 / 1024 < 5;

      if (!isJPG) {
        this.$message.error('上传头像图片只能是 JPG 格式!');
      }
      if (!isLt2M) {
        this.$message.error('上传头像图片大小不能超过 5MB!');
      }
      return isJPG && isLt2M;
    }
      }
    })
    </script>
    </body>
</html>